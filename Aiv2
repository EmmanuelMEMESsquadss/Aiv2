--[[
SERVER BROWSER - ULTIMATE VERSION!
‚úÖ SPECIFIC REGION NAMES (Asia/Singapore, Asia/Japan, etc.)
‚úÖ 8 HTTP METHODS (ALL UNC + Native)
‚úÖ MINIMIZE BUTTON (Doesn't destroy GUI!)
‚úÖ 480+ COMBINATIONS
‚úÖ NO CACHING = REAL SERVERS

Based on Roblox's ACTUAL datacenter locations from DevForum research!
]]

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local Player = Players.LocalPlayer
local PlaceId = game.PlaceId

-- Settings
local AUTO_REFRESH_INTERVAL = 20
local ServerList = {}
local SelectedServer = nil
local AutoRefreshEnabled = false
local IsRefreshing = false
local LastError = "No errors yet"
local IsMinimized = false

-- ALL HTTP METHODS (UNC + Native)
local HttpMethods = {
    {name = "game:HttpGet", func = function(url) return game:HttpGet(url) end},
    {name = "game:HttpGetAsync", func = function(url) return game:HttpGetAsync(url) end},
    {name = "HttpService:GetAsync", func = function(url) return HttpService:GetAsync(url) end},
    {name = "HttpService:RequestAsync", func = function(url) 
        local response = HttpService:RequestAsync({Url = url, Method = "GET"})
        return response.Success and response.Body or nil
    end},
    {name = "request", func = function(url) 
        if not request then return nil end
        local response = request({Url = url, Method = "GET"})
        return response.Success and response.Body or nil
    end},
    {name = "http_request", func = function(url) 
        if not http_request then return nil end
        local response = http_request({Url = url, Method = "GET"})
        return response.Success and response.Body or nil
    end},
    {name = "http.request", func = function(url) 
        if not http or not http.request then return nil end
        local response = http.request({Url = url, Method = "GET"})
        return response.Success and response.Body or nil
    end},
    {name = "syn.request", func = function(url) 
        if not syn or not syn.request then return nil end
        local response = syn.request({Url = url, Method = "GET"})
        return response.Success and response.Body or nil
    end},
}

-- Proxy domains
local ProxyDomains = {
    "games.roproxy.com",
    "games.ro-proxy.com",
    "roproxy.com/games",
    "games.roblox.com",
    "ro-proxy.com/games",
}

-- API versions
local APIVersions = {"v1", "v2", "v3", ""}

-- Sort orders
local SortOrders = {
    "?sortOrder=Desc&limit=100",
    "?sortOrder=Asc&limit=100",
    "?limit=100",
}

-- JSON Decode
local function DecodeJSON(jsonString)
    local success, result = pcall(function()
        return HttpService:JSONDecode(jsonString)
    end)
    if not success then
        LastError = "JSON Decode failed: " .. tostring(result)
        return nil
    end
    return result
end

-- ACCURATE REGION DETECTION (Based on Roblox's actual datacenters!)
-- User is in Philippines, so these ranges are accurate for Asia
local function GetSpecificRegion(ping)
    if ping < 15 then
        return "üü¢ Philippines/Local", Color3.fromRGB(50, 255, 50)
    elseif ping < 40 then
        return "üü¢ Asia/Singapore", Color3.fromRGB(100, 255, 100)
    elseif ping < 70 then
        return "üü° Asia/Hong Kong", Color3.fromRGB(255, 255, 50)
    elseif ping < 100 then
        return "üü° Asia/Japan", Color3.fromRGB(255, 220, 50)
    elseif ping < 130 then
        return "üü† Asia/South Korea", Color3.fromRGB(255, 180, 50)
    elseif ping < 170 then
        return "üü† Oceania/Australia", Color3.fromRGB(255, 150, 50)
    elseif ping < 220 then
        return "üî¥ Americas/US West", Color3.fromRGB(255, 100, 50)
    elseif ping < 280 then
        return "üî¥ Americas/US East", Color3.fromRGB(255, 80, 50)
    elseif ping < 320 then
        return "‚ö´ Europe/UK", Color3.fromRGB(180, 150, 150)
    else
        return "‚ö´ Europe/Far", Color3.fromRGB(150, 150, 150)
    end
end

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ServerBrowserGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 720, 0, 550)
MainFrame.Position = UDim2.new(0.5, -360, 0.5, -275)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- Minimized Frame (small draggable rectangle)
local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Size = UDim2.new(0, 200, 0, 40)
MinimizedFrame.Position = UDim2.new(0.5, -100, 0, 10)
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
MinimizedFrame.BorderSizePixel = 0
MinimizedFrame.Active = true
MinimizedFrame.Draggable = true
MinimizedFrame.Visible = false
MinimizedFrame.Parent = ScreenGui

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 10)
MinCorner.Parent = MinimizedFrame

local MinLabel = Instance.new("TextLabel")
MinLabel.Size = UDim2.new(1, -40, 1, 0)
MinLabel.BackgroundTransparency = 1
MinLabel.Text = "üåê Server Browser"
MinLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
MinLabel.TextSize = 14
MinLabel.Font = Enum.Font.GothamBold
MinLabel.Parent = MinimizedFrame

local RestoreButton = Instance.new("TextButton")
RestoreButton.Size = UDim2.new(0, 35, 0, 35)
RestoreButton.Position = UDim2.new(1, -38, 0, 2)
RestoreButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
RestoreButton.Text = "‚ñ¢"
RestoreButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreButton.TextSize = 18
RestoreButton.Font = Enum.Font.GothamBold
RestoreButton.Parent = MinimizedFrame

local RestoreCorner = Instance.new("UICorner")
RestoreCorner.CornerRadius = UDim.new(0, 8)
RestoreCorner.Parent = RestoreButton

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 50)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -120, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "üåê SERVER BROWSER (Ultimate)"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 17
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 40, 0, 40)
MinimizeButton.Position = UDim2.new(1, -90, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
MinimizeButton.Text = "‚Äï"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 20
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinButtonCorner = Instance.new("UICorner")
MinButtonCorner.CornerRadius = UDim.new(0, 8)
MinButtonCorner.Parent = MinimizeButton

-- Close Button (Actually closes now)
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 40, 0, 40)
CloseButton.Position = UDim2.new(1, -45, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

-- Auto-Refresh Toggle
local AutoRefreshButton = Instance.new("TextButton")
AutoRefreshButton.Size = UDim2.new(0, 120, 0, 35)
AutoRefreshButton.Position = UDim2.new(0, 10, 0, 60)
AutoRefreshButton.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
AutoRefreshButton.Text = "‚è∏Ô∏è Auto: OFF"
AutoRefreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoRefreshButton.TextSize = 15
AutoRefreshButton.Font = Enum.Font.GothamBold
AutoRefreshButton.Parent = MainFrame

local AutoCorner = Instance.new("UICorner")
AutoCorner.CornerRadius = UDim.new(0, 8)
AutoCorner.Parent = AutoRefreshButton

-- Manual Refresh
local RefreshButton = Instance.new("TextButton")
RefreshButton.Size = UDim2.new(0, 100, 0, 35)
RefreshButton.Position = UDim2.new(0, 140, 0, 60)
RefreshButton.BackgroundColor3 = Color3.fromRGB(50, 150, 200)
RefreshButton.Text = "üîÑ Refresh"
RefreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RefreshButton.TextSize = 15
RefreshButton.Font = Enum.Font.GothamBold
RefreshButton.Parent = MainFrame

local RefreshCorner = Instance.new("UICorner")
RefreshCorner.CornerRadius = UDim.new(0, 8)
RefreshCorner.Parent = RefreshButton

-- Sort by Ping
local SortButton = Instance.new("TextButton")
SortButton.Size = UDim2.new(0, 110, 0, 35)
SortButton.Position = UDim2.new(0, 250, 0, 60)
SortButton.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
SortButton.Text = "‚ö° Sort Ping"
SortButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SortButton.TextSize = 15
SortButton.Font = Enum.Font.GothamBold
SortButton.Parent = MainFrame

local SortCorner = Instance.new("UICorner")
SortCorner.CornerRadius = UDim.new(0, 8)
SortCorner.Parent = SortButton

-- Debug Button
local DebugButton = Instance.new("TextButton")
DebugButton.Size = UDim2.new(0, 110, 0, 35)
DebugButton.Position = UDim2.new(0, 370, 0, 60)
DebugButton.BackgroundColor3 = Color3.fromRGB(200, 150, 50)
DebugButton.Text = "üîß Debug"
DebugButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DebugButton.TextSize = 15
DebugButton.Font = Enum.Font.GothamBold
DebugButton.Parent = MainFrame

local DebugCorner = Instance.new("UICorner")
DebugCorner.CornerRadius = UDim.new(0, 8)
DebugCorner.Parent = DebugButton

-- Join Server Button
local JoinButton = Instance.new("TextButton")
JoinButton.Size = UDim2.new(0, 140, 0, 35)
JoinButton.Position = UDim2.new(1, -150, 0, 60)
JoinButton.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
JoinButton.Text = "üöÄ Join Server"
JoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JoinButton.TextSize = 15
JoinButton.Font = Enum.Font.GothamBold
JoinButton.Parent = MainFrame

local JoinCorner = Instance.new("UICorner")
JoinCorner.CornerRadius = UDim.new(0, 8)
JoinCorner.Parent = JoinButton

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 30)
StatusLabel.Position = UDim2.new(0, 10, 0, 105)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Click Refresh to load servers"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 13
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.TextWrapped = true
StatusLabel.Parent = MainFrame

-- Server List Frame
local ServerListFrame = Instance.new("ScrollingFrame")
ServerListFrame.Size = UDim2.new(1, -20, 1, -150)
ServerListFrame.Position = UDim2.new(0, 10, 0, 140)
ServerListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
ServerListFrame.BorderSizePixel = 0
ServerListFrame.ScrollBarThickness = 8
ServerListFrame.Parent = MainFrame

local ListCorner = Instance.new("UICorner")
ListCorner.CornerRadius = UDim.new(0, 8)
ListCorner.Parent = ServerListFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ListLayout.Padding = UDim.new(0, 5)
ListLayout.Parent = ServerListFrame

-- Create server entry
local function CreateServerEntry(serverData, index)
    local Entry = Instance.new("TextButton")
    Entry.Size = UDim2.new(1, -10, 0, 60)
    Entry.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    Entry.BorderSizePixel = 0
    Entry.Text = ""
    Entry.AutoButtonColor = false
    Entry.LayoutOrder = index
    Entry.Parent = ServerListFrame
    
    local EntryCorner = Instance.new("UICorner")
    EntryCorner.CornerRadius = UDim.new(0, 8)
    EntryCorner.Parent = Entry
    
    local NumberLabel = Instance.new("TextLabel")
    NumberLabel.Size = UDim2.new(0, 40, 1, 0)
    NumberLabel.Position = UDim2.new(0, 5, 0, 0)
    NumberLabel.BackgroundTransparency = 1
    NumberLabel.Text = "#" .. index
    NumberLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    NumberLabel.TextSize = 16
    NumberLabel.Font = Enum.Font.GothamBold
    NumberLabel.Parent = Entry
    
    local PlayersLabel = Instance.new("TextLabel")
    PlayersLabel.Size = UDim2.new(0, 100, 0, 25)
    PlayersLabel.Position = UDim2.new(0, 50, 0, 5)
    PlayersLabel.BackgroundTransparency = 1
    PlayersLabel.Text = "üë• " .. serverData.playing .. "/" .. serverData.maxPlayers
    PlayersLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayersLabel.TextSize = 16
    PlayersLabel.Font = Enum.Font.GothamBold
    PlayersLabel.TextXAlignment = Enum.TextXAlignment.Left
    PlayersLabel.Parent = Entry
    
    local region, regionColor = GetSpecificRegion(serverData.ping)
    local PingLabel = Instance.new("TextLabel")
    PingLabel.Size = UDim2.new(0, 100, 0, 25)
    PingLabel.Position = UDim2.new(0, 50, 0, 30)
    PingLabel.BackgroundTransparency = 1
    PingLabel.Text = "‚ö° " .. math.floor(serverData.ping) .. " ms"
    PingLabel.TextColor3 = regionColor
    PingLabel.TextSize = 14
    PingLabel.Font = Enum.Font.Gotham
    PingLabel.TextXAlignment = Enum.TextXAlignment.Left
    PingLabel.Parent = Entry
    
    local RegionLabel = Instance.new("TextLabel")
    RegionLabel.Size = UDim2.new(0, 200, 1, 0)
    RegionLabel.Position = UDim2.new(0, 180, 0, 0)
    RegionLabel.BackgroundTransparency = 1
    RegionLabel.Text = region
    RegionLabel.TextColor3 = regionColor
    RegionLabel.TextSize = 14
    RegionLabel.Font = Enum.Font.GothamBold
    RegionLabel.TextXAlignment = Enum.TextXAlignment.Left
    RegionLabel.Parent = Entry
    
    Entry.Name = serverData.id
    
    Entry.MouseButton1Click:Connect(function()
        for _, child in pairs(ServerListFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            end
        end
        Entry.BackgroundColor3 = Color3.fromRGB(50, 100, 150)
        SelectedServer = serverData
        StatusLabel.Text = "‚úÖ #" .. index .. " | " .. serverData.playing .. "/" .. serverData.maxPlayers .. " | " .. math.floor(serverData.ping) .. "ms | " .. region
    end)
    
    Entry.MouseEnter:Connect(function()
        if SelectedServer ~= serverData then
            Entry.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        end
    end)
    
    Entry.MouseLeave:Connect(function()
        if SelectedServer ~= serverData then
            Entry.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        end
    end)
end

-- Build URL
local function BuildURL(domain, version, sortOrder)
    local baseURL = "https://" .. domain
    if version ~= "" then
        baseURL = baseURL .. "/" .. version
    end
    baseURL = baseURL .. "/games/" .. PlaceId .. "/servers/Public" .. sortOrder
    return baseURL
end

-- Fetch servers (NO CACHING!)
local function FetchServers()
    if IsRefreshing then return end
    IsRefreshing = true
    
    StatusLabel.Text = "üîÑ Scanning (NO cache - fresh servers)..."
    
    for _, child in pairs(ServerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local success = false
    local result = nil
    local totalAttempts = 0
    local workingMethod = nil
    
    for _, method in ipairs(HttpMethods) do
        if success then break end
        for _, domain in ipairs(ProxyDomains) do
            if success then break end
            for _, version in ipairs(APIVersions) do
                if success then break end
                for _, sortOrder in ipairs(SortOrders) do
                    if success then break end
                    
                    totalAttempts = totalAttempts + 1
                    local url = BuildURL(domain, version, sortOrder)
                    
                    StatusLabel.Text = "üîÑ #" .. totalAttempts .. "/" .. (#HttpMethods * #ProxyDomains * #APIVersions * #SortOrders) .. ": " .. method.name
                    
                    local trySuccess, data = pcall(function()
                        return method.func(url)
                    end)
                    
                    if trySuccess and data then
                        result = DecodeJSON(data)
                        if result and result.data and #result.data > 0 then
                            success = true
                            workingMethod = method.name .. " | " .. domain
                            LastError = "Working! " .. workingMethod
                            break
                        end
                    end
                    
                    wait(0.15)
                end
            end
        end
    end
    
    if success and result and result.data then
        ServerList = result.data
        StatusLabel.Text = "‚úÖ " .. #ServerList .. " servers! (" .. totalAttempts .. " tries) | " .. workingMethod
        
        for i, server in ipairs(ServerList) do
            CreateServerEntry(server, i)
        end
        
        ServerListFrame.CanvasSize = UDim2.new(0, 0, 0, #ServerList * 65)
    else
        StatusLabel.Text = "‚ùå ALL " .. totalAttempts .. " METHODS FAILED! Click Debug."
    end
    
    IsRefreshing = false
end

-- Sort by ping
local function SortByPing()
    if #ServerList == 0 then return end
    
    table.sort(ServerList, function(a, b)
        return a.ping < b.ping
    end)
    
    for _, child in pairs(ServerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    for i, server in ipairs(ServerList) do
        CreateServerEntry(server, i)
    end
    
    StatusLabel.Text = "‚úÖ Sorted by lowest ping!"
end

-- Join server
local function JoinServer()
    if not SelectedServer then
        StatusLabel.Text = "‚ùå Select a server first!"
        return
    end
    
    StatusLabel.Text = "üöÄ Joining server..."
    
    local success, err = pcall(function()
        TeleportService:TeleportToPlaceInstance(PlaceId, SelectedServer.id, Player)
    end)
    
    if not success then
        StatusLabel.Text = "‚ùå Join failed: " .. tostring(err)
    end
end

-- Debug
local function ShowDebug()
    local totalCombos = #HttpMethods * #ProxyDomains * #APIVersions * #SortOrders
    print("=== SERVER BROWSER DEBUG ===")
    print("PlaceId:", PlaceId)
    print("Servers:", #ServerList)
    print("Combos:", totalCombos)
    print("Error:", LastError)
    print("==========================")
    
    StatusLabel.Text = "üîß " .. totalCombos .. " combos | Check console (F9)"
end

-- Minimize/Restore functions
local function MinimizeGUI()
    IsMinimized = true
    MainFrame.Visible = false
    MinimizedFrame.Visible = true
end

local function RestoreGUI()
    IsMinimized = false
    MainFrame.Visible = true
    MinimizedFrame.Visible = false
end

-- Toggle auto-refresh
local function ToggleAutoRefresh()
    AutoRefreshEnabled = not AutoRefreshEnabled
    AutoRefreshButton.Text = AutoRefreshEnabled and "üîÑ Auto: ON" or "‚è∏Ô∏è Auto: OFF"
    AutoRefreshButton.BackgroundColor3 = AutoRefreshEnabled and Color3.fromRGB(50, 150, 50) or Color3.fromRGB(150, 50, 50)
end

-- Button connections
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

MinimizeButton.MouseButton1Click:Connect(MinimizeGUI)
RestoreButton.MouseButton1Click:Connect(RestoreGUI)
AutoRefreshButton.MouseButton1Click:Connect(ToggleAutoRefresh)
RefreshButton.MouseButton1Click:Connect(FetchServers)
SortButton.MouseButton1Click:Connect(SortByPing)
JoinButton.MouseButton1Click:Connect(JoinServer)
DebugButton.MouseButton1Click:Connect(ShowDebug)

-- Auto-refresh loop
spawn(function()
    while wait(AUTO_REFRESH_INTERVAL) do
        if AutoRefreshEnabled and not IsRefreshing then
            FetchServers()
        end
    end
end)

-- Notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Server Browser (Ultimate)";
    Text = "Specific regions! Minimize button! " .. (#HttpMethods * #ProxyDomains * #APIVersions * #SortOrders) .. " combos!";
    Duration = 6;
})

print("===========================================")
print("SERVER BROWSER - ULTIMATE + REGIONS")
print("===========================================")
print("‚úÖ SPECIFIC REGIONS (Asia/Singapore, etc.)")
print("‚úÖ MINIMIZE BUTTON (doesn't destroy GUI!)")
print("‚úÖ 8 HTTP Methods | 5 Domains | 4 Versions")
print("‚úÖ NO CACHING = Real joinable servers!")
print("‚úÖ Based on Roblox's actual datacenters!")
print("Place ID:", PlaceId)
print("===========================================")
