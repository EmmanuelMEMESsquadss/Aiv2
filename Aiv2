--[[
ROBLOX SERVER BROWSER SCRIPT - MOBILE COMPATIBLE
Works with Arceus X and other mobile executors!

FIXED: Uses request() function instead of HttpService for mobile
FEATURES:
- Shows all available servers
- Displays ping (ms)
- Shows player count and max players
- Estimates region based on ping
- Sort by lowest ping
- Refresh server list
- Join selected server
- Fully draggable GUI

USAGE:
1. Execute in Arceus X (mobile) or any executor
2. Browse servers
3. Select and join
]]

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")

local Player = Players.LocalPlayer
local PlaceId = game.PlaceId

-- Check which HTTP method is available
local httpRequest = request or http_request or http or syn.request

if not httpRequest then
    warn("[SERVER BROWSER] No HTTP request function found! This executor may not support HTTP requests.")
end

-- Server list storage
local ServerList = {}
local SelectedServer = nil

-- Create Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ServerBrowserGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 700, 0, 500)
MainFrame.Position = UDim2.new(0.5, -350, 0.5, -250)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 50)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -120, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "üåê SERVER BROWSER (Mobile)"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 40, 0, 40)
CloseButton.Position = UDim2.new(1, -45, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

-- Refresh Button
local RefreshButton = Instance.new("TextButton")
RefreshButton.Size = UDim2.new(0, 100, 0, 35)
RefreshButton.Position = UDim2.new(0, 10, 0, 60)
RefreshButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
RefreshButton.Text = "üîÑ Refresh"
RefreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
RefreshButton.TextSize = 16
RefreshButton.Font = Enum.Font.GothamBold
RefreshButton.Parent = MainFrame

local RefreshCorner = Instance.new("UICorner")
RefreshCorner.CornerRadius = UDim.new(0, 8)
RefreshCorner.Parent = RefreshButton

-- Sort by Ping Button
local SortButton = Instance.new("TextButton")
SortButton.Size = UDim2.new(0, 120, 0, 35)
SortButton.Position = UDim2.new(0, 120, 0, 60)
SortButton.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
SortButton.Text = "‚ö° Sort by Ping"
SortButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SortButton.TextSize = 16
SortButton.Font = Enum.Font.GothamBold
SortButton.Parent = MainFrame

local SortCorner = Instance.new("UICorner")
SortCorner.CornerRadius = UDim.new(0, 8)
SortCorner.Parent = SortButton

-- Join Server Button
local JoinButton = Instance.new("TextButton")
JoinButton.Size = UDim2.new(0, 150, 0, 35)
JoinButton.Position = UDim2.new(1, -160, 0, 60)
JoinButton.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
JoinButton.Text = "üöÄ Join Server"
JoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
JoinButton.TextSize = 16
JoinButton.Font = Enum.Font.GothamBold
JoinButton.Parent = MainFrame

local JoinCorner = Instance.new("UICorner")
JoinCorner.CornerRadius = UDim.new(0, 8)
JoinCorner.Parent = JoinButton

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 25)
StatusLabel.Position = UDim2.new(0, 10, 0, 105)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Loading servers..."
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 14
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = MainFrame

-- Server List Frame
local ServerListFrame = Instance.new("ScrollingFrame")
ServerListFrame.Size = UDim2.new(1, -20, 1, -145)
ServerListFrame.Position = UDim2.new(0, 10, 0, 135)
ServerListFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
ServerListFrame.BorderSizePixel = 0
ServerListFrame.ScrollBarThickness = 8
ServerListFrame.Parent = MainFrame

local ListCorner = Instance.new("UICorner")
ListCorner.CornerRadius = UDim.new(0, 8)
ListCorner.Parent = ServerListFrame

local ListLayout = Instance.new("UIListLayout")
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ListLayout.Padding = UDim.new(0, 5)
ListLayout.Parent = ServerListFrame

-- Function to determine region based on ping
local function GetRegion(ping)
    if ping < 50 then
        return "üü¢ Local", Color3.fromRGB(50, 255, 50)
    elseif ping < 100 then
        return "üü° Nearby", Color3.fromRGB(255, 255, 50)
    elseif ping < 150 then
        return "üü† Regional", Color3.fromRGB(255, 150, 50)
    elseif ping < 250 then
        return "üî¥ Far", Color3.fromRGB(255, 100, 50)
    else
        return "‚ö´ Very Far", Color3.fromRGB(150, 150, 150)
    end
end

-- Function to create server entry
local function CreateServerEntry(serverData, index)
    local Entry = Instance.new("TextButton")
    Entry.Size = UDim2.new(1, -10, 0, 60)
    Entry.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    Entry.BorderSizePixel = 0
    Entry.Text = ""
    Entry.AutoButtonColor = false
    Entry.LayoutOrder = index
    Entry.Parent = ServerListFrame
    
    local EntryCorner = Instance.new("UICorner")
    EntryCorner.CornerRadius = UDim.new(0, 8)
    EntryCorner.Parent = Entry
    
    -- Server Number
    local NumberLabel = Instance.new("TextLabel")
    NumberLabel.Size = UDim2.new(0, 40, 1, 0)
    NumberLabel.Position = UDim2.new(0, 5, 0, 0)
    NumberLabel.BackgroundTransparency = 1
    NumberLabel.Text = "#" .. index
    NumberLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    NumberLabel.TextSize = 16
    NumberLabel.Font = Enum.Font.GothamBold
    NumberLabel.Parent = Entry
    
    -- Players
    local PlayersLabel = Instance.new("TextLabel")
    PlayersLabel.Size = UDim2.new(0, 100, 0, 25)
    PlayersLabel.Position = UDim2.new(0, 50, 0, 5)
    PlayersLabel.BackgroundTransparency = 1
    PlayersLabel.Text = "üë• " .. serverData.playing .. "/" .. serverData.maxPlayers
    PlayersLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    PlayersLabel.TextSize = 16
    PlayersLabel.Font = Enum.Font.GothamBold
    PlayersLabel.TextXAlignment = Enum.TextXAlignment.Left
    PlayersLabel.Parent = Entry
    
    -- Ping
    local region, regionColor = GetRegion(serverData.ping)
    local PingLabel = Instance.new("TextLabel")
    PingLabel.Size = UDim2.new(0, 120, 0, 25)
    PingLabel.Position = UDim2.new(0, 50, 0, 30)
    PingLabel.BackgroundTransparency = 1
    PingLabel.Text = "‚ö° " .. math.floor(serverData.ping) .. " ms"
    PingLabel.TextColor3 = regionColor
    PingLabel.TextSize = 14
    PingLabel.Font = Enum.Font.Gotham
    PingLabel.TextXAlignment = Enum.TextXAlignment.Left
    PingLabel.Parent = Entry
    
    -- Region
    local RegionLabel = Instance.new("TextLabel")
    RegionLabel.Size = UDim2.new(0, 150, 1, 0)
    RegionLabel.Position = UDim2.new(0, 200, 0, 0)
    RegionLabel.BackgroundTransparency = 1
    RegionLabel.Text = region
    RegionLabel.TextColor3 = regionColor
    RegionLabel.TextSize = 14
    RegionLabel.Font = Enum.Font.GothamBold
    RegionLabel.TextXAlignment = Enum.TextXAlignment.Left
    RegionLabel.Parent = Entry
    
    -- Server ID (hidden, for joining)
    Entry.Name = serverData.id
    
    -- Click handler
    Entry.MouseButton1Click:Connect(function()
        -- Deselect all
        for _, child in pairs(ServerListFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            end
        end
        
        -- Select this one
        Entry.BackgroundColor3 = Color3.fromRGB(50, 100, 150)
        SelectedServer = serverData
        StatusLabel.Text = "Selected: Server #" .. index .. " - " .. serverData.playing .. "/" .. serverData.maxPlayers .. " players"
    end)
    
    -- Hover effect
    Entry.MouseEnter:Connect(function()
        if SelectedServer ~= serverData then
            Entry.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        end
    end)
    
    Entry.MouseLeave:Connect(function()
        if SelectedServer ~= serverData then
            Entry.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        end
    end)
    
    return Entry
end

-- Function to parse JSON manually (fallback if game:GetService("HttpService") fails)
local function DecodeJSON(jsonString)
    local success, result = pcall(function()
        return game:GetService("HttpService"):JSONDecode(jsonString)
    end)
    if success then
        return result
    else
        warn("[SERVER BROWSER] Failed to decode JSON:", result)
        return nil
    end
end

-- Function to fetch servers using mobile executor request()
local function FetchServers()
    StatusLabel.Text = "Fetching servers..."
    ServerList = {}
    SelectedServer = nil
    
    -- Clear existing entries
    for _, child in pairs(ServerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    if not httpRequest then
        StatusLabel.Text = "‚ùå HTTP requests not supported on this executor!"
        return
    end
    
    local success, result = pcall(function()
        -- Use RoProxy to access Roblox Games API
        local url = "https://games.roproxy.com/v1/games/" .. PlaceId .. "/servers/Public?sortOrder=Desc&limit=100"
        
        -- Make HTTP request using mobile executor method
        local response = httpRequest({
            Url = url,
            Method = "GET"
        })
        
        -- Check if response is valid
        if response and response.Success and response.Body then
            return DecodeJSON(response.Body)
        elseif response and response.StatusCode then
            warn("[SERVER BROWSER] HTTP Error:", response.StatusCode, response.StatusMessage)
            return nil
        else
            warn("[SERVER BROWSER] Invalid response from HTTP request")
            return nil
        end
    end)
    
    if success and result and result.data then
        ServerList = result.data
        StatusLabel.Text = "Found " .. #ServerList .. " servers!"
        
        -- Create entries for each server
        for i, server in ipairs(ServerList) do
            CreateServerEntry(server, i)
        end
        
        -- Update canvas size
        ServerListFrame.CanvasSize = UDim2.new(0, 0, 0, #ServerList * 65)
    else
        StatusLabel.Text = "‚ùå Failed to fetch servers. Error: " .. tostring(result)
        warn("[SERVER BROWSER] Error:", result)
    end
end

-- Sort by ping function
local function SortByPing()
    StatusLabel.Text = "Sorting by ping..."
    
    if #ServerList == 0 then
        StatusLabel.Text = "‚ùå No servers to sort!"
        return
    end
    
    -- Sort ServerList by ping
    table.sort(ServerList, function(a, b)
        return a.ping < b.ping
    end)
    
    -- Clear and recreate entries
    for _, child in pairs(ServerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    for i, server in ipairs(ServerList) do
        CreateServerEntry(server, i)
    end
    
    StatusLabel.Text = "Sorted by lowest ping! " .. #ServerList .. " servers."
end

-- Join server function
local function JoinServer()
    if not SelectedServer then
        StatusLabel.Text = "‚ùå Please select a server first!"
        return
    end
    
    StatusLabel.Text = "üöÄ Joining server..."
    
    local success, err = pcall(function()
        TeleportService:TeleportToPlaceInstance(PlaceId, SelectedServer.id, Player)
    end)
    
    if not success then
        StatusLabel.Text = "‚ùå Failed to join: " .. tostring(err)
        warn("[SERVER BROWSER] Teleport error:", err)
    end
end

-- Button connections
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

RefreshButton.MouseButton1Click:Connect(FetchServers)
SortButton.MouseButton1Click:Connect(SortByPing)
JoinButton.MouseButton1Click:Connect(JoinServer)

-- Initial fetch
wait(0.5) -- Small delay to ensure everything is loaded
FetchServers()

-- Notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Server Browser (Mobile)";
    Text = "Compatible with Arceus X! Browse & join servers.";
    Duration = 5;
})

print("===========================================")
print("ROBLOX SERVER BROWSER - MOBILE COMPATIBLE")
print("===========================================")
print("‚úÖ Loaded successfully!")
print("üì± Works with Arceus X and mobile executors")
print("üìä Uses request() function for HTTP")
print("üéÆ Drag the window to move it")
print("===========================================")
